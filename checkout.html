<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>NeoMindzLive — Checkout</title>

    <link rel="stylesheet" href="./css/checkout.css" />
    <script src="./js/config.js"></script>

  <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
</head>

<body class="page">
    <!-- TOP BAR -->
    <header class="topbar">
        <div class="topbar-inner">
            <a class="brand" href="./en.html">
                <!-- agar assets/logo.png bo'lmasa, shunchaki text qoladi -->
                <img class="brand-logo" src="./assets/logo/logo.png" alt="NeoMindzLive"
                    onerror="this.style.display='none'">
                <span class="brand-name">NeoMindzLive</span>
            </a>

            <div class="topbar-right">
                <span class="hide-sm">contact: +(998)88 033-8526 </span>
                <a class="hide-sm" href="mailto:contact@neomindzlive.com">neomindzlive@gmail.com</a>
                <a class="login-btn" href="./login.html">Login</a>
            </div>
        </div>
    </header>

    <!-- HERO -->
    <main>
        <section class="hero">
            <div class="hero-left">
                <h1>Want to Know Your<br />Real IQ Score</h1>
                <p>Take our IQ test and unlock your path to self-discovery and development.</p>

                <div class="hero-actions">
                   <button class="btn primary" id="startBtn" type="button">Start IQ Test Now →</button>

                </div>
                <div class="reviews-row">
                    <strong>Excellent user reviews</strong>
                    <span class="stars">★★★★★</span>
                </div>
                <div class="tests-today">
                    <strong>12024</strong> IQ tests taken today!
                </div>
            </div>
            </div>
            </div>

            <div class="hero-right">
                <div class="hero-frame">
                    <!-- Sizda bor deb aytgandingiz: assets/details/iqscore.png -->
                    <img src="./assets/details/statistics.png" alt="IQ distribution graph"
                        onerror="this.style.opacity='.25'; this.alt='(add graph image)';">
                </div>
            </div>
        </section>



        <!-- HOW IT WORKS -->
        <section class="how" id="how">
            <h2>How it Works</h2>

            <!-- BU YERDA 4 TA KARTA: IQ Score / Certificate / Correct Answers / IQ Boost -->
            <div class="feature-cards">

                <!-- 1) Take a Test -->
                <button class="feature-card" type="button">
                    <div class="feature-ico">
                        <img src="./assets/details/docs.png" alt="Take a Test">
                    </div>
                    <div class="feature-title">Take a Test</div>
                    <div class="feature-desc">
                        Get an unbiased view of yourself
                    </div>
                </button>

                <!-- 2) Get Your Detailed Report -->
                <button class="feature-card" type="button">
                    <div class="feature-ico">
                        <img src="./assets/details/report.png" alt="Detailed Report">
                    </div>
                    <div class="feature-title">Get Your Detailed Report</div>
                    <div class="feature-desc">
                        Learn your strengths and discover areas for growth
                    </div>
                </button>

                <!-- 3) Begin Your Journey -->
                <button class="feature-card" type="button">
                    <div class="feature-ico">
                        <img src="./assets/details/check.png" alt="Begin Your Journey">
                    </div>
                    <div class="feature-title">Begin Your Journey</div>
                    <div class="feature-desc">
                        Start improving with expert courses and brain training
                    </div>
                </button>

            </div>

        </section>
    </main>

    <!-- FLYOUT MENU -->
    <div id="flyoutOverlay" class="flyout-overlay" aria-hidden="true"></div>

    <aside id="flyoutPanel" class="flyout-panel" aria-hidden="true">
        <div class="flyout-head">
            <div>
                <div id="flyoutTitle" class="flyout-title">Menu</div>
                <div id="flyoutDesc" class="flyout-desc">Choose an action</div>
            </div>
            <button id="flyoutClose" class="flyout-close" type="button" aria-label="Close">✕</button>
        </div>

        <div id="flyoutLinks" class="flyout-links"></div>

        <div class="flyout-bottom">
            <button id="flyoutPay" class="pay-btn" type="button">$1.49 — Pay & Start</button>
            <div class="pay-note">One-time payment • 1 test access</div>
        </div>
    </aside>

      
    <footer class="footer">
        <div class="footer-inner">
            <div class="footer-left">
                © 2026 NeoMindzLive. All rights reserved.
            </div>

            <div class="footer-right">
                <a href="./support.html">Support center</a>
                <a href="./contact.html">Contact</a>
                <a href="./terms.html">Terms</a>
                <a href="./privacy.html">Privacy</a>
                <a href="./refund.html">Refund</a>
            </div>
        </div>
    </footer>

    <script>
document.addEventListener("DOMContentLoaded", () => {
  const KEY = "neomindz_user_id";
  if (!localStorage.getItem(KEY)) {
    localStorage.setItem(KEY, "user_" + crypto.randomUUID());
  }

  const btn =
    document.getElementById("startBtn") ||
    document.querySelector('[data-start="test"]') ||
    document.querySelector(".start-btn") ||
    document.querySelector(".btn.primary");

  if (!btn) {
    console.warn("Start button topilmadi!");
    return;
  }

  // eski click handlerlar bo'lsa ham ishlashi uchun
  btn.style.pointerEvents = "auto";
  btn.style.zIndex = "50";

  btn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    window.location.href = "./test.html";
  }, true);
});
</script>


<script id="NEO_CHECKOUT_SCRIPT">
(() => {
  const API_BASE = (window.NEO_API_BASE || "http://127.0.0.1:8000").replace(/\/$/, "");

  function getUserId() {
    let id = localStorage.getItem("neo_user_id");
    if (!id) {
      id = "user_" + crypto.randomUUID();
      localStorage.setItem("neo_user_id", id);
    }
    return id;
  }
  const USER_ID = getUserId();

  function api(path, opts = {}) {
    const headers = Object.assign({ "Content-Type": "application/json", "X-User-Id": USER_ID }, opts.headers || {});
    return fetch(API_BASE + path, Object.assign({}, opts, { headers }))
      .then(async (r) => {
        if (!r.ok) {
          const t = await r.text().catch(() => "");
          const err = new Error(t || ("HTTP " + r.status));
          err.status = r.status;
          throw err;
        }
        return r.json();
      });
  }

  const params = new URLSearchParams(location.search);
  const sessionId = params.get("session_id");

  // Minimal UI: agar sahifada maxsus btn bo'lmasa ham ishlashi uchun
  let payBtn = document.getElementById("payBtn");
  if (!payBtn) {
    payBtn = document.createElement("button");
    payBtn.id = "payBtn";
    payBtn.className = "cta-btn";
    payBtn.type = "button";
    payBtn.textContent = "$1.49 — Pay & Unlock";
    const host = document.querySelector(".hero-left") || document.body;
    host.appendChild(payBtn);
  }

  async function pollUnlock() {
    // unlock bo'lguncha status tekshiramiz
    for (let i = 0; i < 60; i++) { // ~60s
      try {
        const st = await api(`/api/test/status?session_id=${encodeURIComponent(sessionId)}`);
        if (st?.session && st.session.result_locked === 0) {
          const url = new URL("./result.html", window.location.href);
          url.searchParams.set("session_id", sessionId);
          window.location.href = url.toString();
          return;
        }
      } catch (e) {}
      await new Promise(r => setTimeout(r, 1000));
    }
    alert("Payment received but unlock is still processing. Please refresh the Result page in a minute.");
  }

  payBtn.addEventListener("click", async () => {
    if (!sessionId) {
      alert("Missing session_id");
      return;
    }

    // ==== PADDLE SETTINGS (fill these) ====
    // 1) Paddle Client-side Token (Billing)
    // 2) Price ID (Billing) or Product ID (Classic)
    const PADDLE_CLIENT_TOKEN = window.PADDLE_CLIENT_TOKEN || ""; // TODO: set in checkout.html or config.js
    const PADDLE_PRICE_ID = window.PADDLE_PRICE_ID || "";         // TODO: set

    if (!window.Paddle) {
      alert("Paddle script not loaded.");
      return;
    }
    if (!PADDLE_CLIENT_TOKEN || !PADDLE_PRICE_ID) {
      alert("Set PADDLE_CLIENT_TOKEN and PADDLE_PRICE_ID in checkout.html/config.js");
      return;
    }

    try {
      payBtn.disabled = true;
      payBtn.textContent = "Opening checkout…";

      Paddle.Initialize({ token: PADDLE_CLIENT_TOKEN });

      Paddle.Checkout.open({
        items: [{ priceId: PADDLE_PRICE_ID, quantity: 1 }],
        customData: { session_id: sessionId, user_id: USER_ID },
        successCallback: function() {
          // Unlock webhook orqali bo'ladi — polling qilamiz
          payBtn.textContent = "Payment success. Unlocking…";
          pollUnlock();
        }
      });
    } catch (e) {
      console.error(e);
      alert("Checkout error: " + (e.message || e));
    } finally {
      payBtn.disabled = false;
      payBtn.textContent = "$1.49 — Pay & Unlock";
    }
  });
})();
</script>
</body>


</html>